
import { ProgramMetadata } from "@gear-js/api";
import { Button } from "@gear-js/ui";
import { useState } from "react";
import { useApi, useAlert } from "@gear-js/react-hooks";
import { AnyJson } from "@polkadot/types/types";
import { GearApi } from '@gear-js/api';
import { Result } from "@polkadot/types";

function ReadState() {
  const { api } = useApi();

  const alert = useAlert();

  const [fullState, setFullState] = useState<AnyJson>([]);

  // Add your programID
  const programIDFT =
    "0x633d0f014702f15973932d129e12f5c144124de630125239c764694a143c6a28";

   // Add your metadata.txt
  const meta =
    "0002000100000000000104000000010a0000000000000000010b000000491248000808696f18496e69744654000004013466745f70726f6772616d5f696404011c4163746f72496400000410106773746418636f6d6d6f6e287072696d6974697665731c4163746f724964000004000801205b75383b2033325d000008000003200000000c000c0000050300100808696f48416374696f6e4761696145636f747261636b000118304e657747656e657261746f72080004011c4163746f724964000014012447656e657261746f720000003847656e6572617465456e6572677904001801107531323800010028476574526577617264730400180110753132380002002c5472616e736665727265640c0004011c4163746f724964000004011c4163746f72496400001801107531323800030018526577617264100004011c4163746f724964000004011c4163746f72496400001801107531323800001c01405472616e73616374696f6e73496e666f000400244e65774465766963650800200118537472696e67000024012c44657669636573496e666f00050000140808696f2447656e657261746f72000014010869641801107531323800011877616c6c657404011c4163746f72496400013c746f74616c5f67656e65726174656418011075313238000138617665726167655f656e657267791801107531323800011c726577617264731801107531323800001800000507001c0808696f405472616e73616374696f6e73496e666f00000c0108746f04011c4163746f724964000118616d6f756e74180110753132380001086b77180110753132380000200000050200240808696f2c44657669636573496e666f00001001086964180110753132380001106e616d65200118537472696e6700012c747970655f656e65726779200118537472696e6700011873657269616c200118537472696e670000280808696f484576656e74734761696145636f747261636b00011828526567697374657265640000002447656e657261746564000100405265776172647347656e65726174656400020044546f6b656e735472616e736665727265640c011066726f6d04011c4163746f724964000108746f04011c4163746f724964000118616d6f756e74180110753132380003001c436c61696d65640c0108746f04011c4163746f724964000118616d6f756e74180110753132380001086b77180110753132380004003844657669636552656769737465720400200118537472696e67000500002c0808696f38496f4761696145636f747261636b0000180158746f74616c5f656e657267795f67656e6572617465641801107531323800012c746f74616c5f757365727318011075313238000140746f74616c5f67656e657261746f72731801107531323800012867656e657261746f72733001645665633c284163746f7249642c2047656e657261746f72293e00011c646576696365733801685665633c28537472696e672c2044657669636573496e666f293e0001307472616e73616374696f6e734001805665633c284163746f7249642c205472616e73616374696f6e73496e666f293e00003000000234003400000408041400380000023c003c000004082024004000000244004400000408041c00";

  const metadata = ProgramMetadata.from(meta);

  const getState = async () => {
    const api = await GearApi.create({
      providerAddress: 'wss://testnet.vara.network',
    });
    
    await api.programState.read({
      programId: '0xc86da0e051bcc8b0799e9f72c039f6a87f1105574fff7919a2f02a48124c8f9e',
      payload: undefined
    }, metadata)
    .then((result)=>{
      setFullState(result.toJSON());
      alert.success("Successful state");
    })
    .catch(({ message }: Error) => alert.error(message))

    }
  
    console.log(fullState?.transactions);

    const transactionId = "0x6486cf58687624dea8be82895cb23190d60d3232805119718642eee3ae3fbc2d";
    const foundTransaction = fullState?.transactions.find(transaction => {
      return Array.isArray(transaction) && transaction.length === 2 && transaction[0] === transactionId;
    });
    
    console.log(foundTransaction);
    
    
  

  return (
    <div className="container">
      <center>Full State</center>
      <center className="state">
        State
        <p className="text"> {JSON.stringify(fullState)}</p>
      </center>
      <Button text="Get Full State" onClick={getState} />
    </div>
  );
}

export { ReadState };

    