import { ProgramMetadata } from "@gear-js/api";
import { Button } from "@gear-js/ui";
import { useState } from "react";
import { useApi, useAlert } from "@gear-js/react-hooks";
import { AnyJson } from "@polkadot/types/types";

function ReadState() {
  const { api } = useApi();

  const alert = useAlert();

  const [fullState, setFullState] = useState<AnyJson>();

     // Add your programID
     const programIDFT =
     "0x8bbcb43d6df2d474e23516fdd99e472d452e0a2cdf667e331fe39509219ba351";
  
    // Add your metadata.txt
   const meta =
   "0002000100000000000104000000010700000000000000000108000000350a2c000808696f18496e69744654000004013466745f70726f6772616d5f696404011c4163746f72496400000410106773746418636f6d6d6f6e287072696d6974697665731c4163746f724964000004000801205b75383b2033325d000008000003200000000c000c0000050300100808696f48416374696f6e4761696145636f747261636b000110304e657747656e657261746f72080004011c4163746f724964000014012447656e657261746f720000003847656e6572617465456e6572677904001801107531323800010028476574526577617264730400180110753132380002002c5472616e736665727265640c0004011c4163746f724964000004011c4163746f72496400001801107531323800030000140808696f2447656e657261746f72000014010869641801107531323800011877616c6c657404011c4163746f72496400013c746f74616c5f67656e65726174656418011075313238000138617665726167655f656e657267791801107531323800011c726577617264731801107531323800001800000507001c0808696f484576656e74734761696145636f747261636b00011028526567697374657265640000002447656e657261746564000100405265776172647347656e65726174656400020044546f6b656e735472616e7366657272656400030000200808696f38496f4761696145636f747261636b0000100158746f74616c5f656e657267795f67656e6572617465641801107531323800012c746f74616c5f757365727318011075313238000140746f74616c5f67656e657261746f72731801107531323800012867656e657261746f72732401645665633c284163746f7249642c2047656e657261746f72293e00002400000228002800000408041400"

  const metadata = ProgramMetadata.from(meta);


  console.log(metadata)
  

  
  const getState = () => {

    api.programState
      .read({ programId: programIDFT,payload:"" }, metadata)
      .then((result) => {
        setFullState(result.toJSON());
        alert.success("Successful state");
      })
      .catch(({ message }: Error) => alert.error(message));
  };

  

  return (
    <div className="text-black">
      <div>Full State</div>
      <div className="state">
        State
        <p className="text"> {JSON.stringify(fullState)}</p>
      </div>
      <Button text="Get gdfgFull State" onClick={getState} />
    </div>
  );
}

export { ReadState };
